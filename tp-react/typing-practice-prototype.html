<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Typing Practice</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-top: 18vh;
            background-color: #fafafa;
            color: #333;
        }

        body.dark {
            background-color: #0f0f0f;
            color: #e5e7eb;
        }

        .display-none {
            display: none !important;
        }

        /* ì¢Œì¸¡ ìƒë‹¨ ì»¨íŠ¸ë¡¤ */
        .top-left-controls {
            position: fixed;
            top: 1rem;
            left: 1rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            z-index: 100;
        }

        /* í°íŠ¸ ìŠ¬ë¼ì´ë” */
        .font-size-slider-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .font-size-label {
            font-size: 0.75rem;
            color: #999;
            cursor: pointer;
        }

        .font-size-label.dark {
            color: #666;
        }

        .font-size-slider {
            width: 100px;
            height: 4px;
            background: #e5e7eb;
            cursor: pointer;
        }

        .font-size-slider.dark {
            background: #3f3f46;
        }

        /* ëª¨ë“œ í† ê¸€ */
        .mode-toggle-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mode-toggle-label {
            font-size: 0.75rem;
            color: #999;
            cursor: pointer;
        }

        .mode-toggle-label.dark {
            color: #666;
        }

        .mode-toggle {
            position: relative;
            width: 36px;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .mode-toggle.dark {
            background: #3f3f46;
        }

        .mode-toggle.active {
            background: #6d28d9;
        }

        .mode-toggle.active.dark {
            background: #8b5cf6;
        }

        .mode-toggle-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .mode-toggle.active .mode-toggle-knob {
            transform: translateX(16px);
        }

        /* ê³µì§€ ì•„ì´ì½˜ */
        .notice-icon {
            position: fixed;
            top: 1rem;
            right: 1rem;
            color: #999;
            cursor: pointer;
            font-size: 1.25rem;
            transition: color 0.2s;
            z-index: 100;
        }

        .notice-icon:hover {
            color: #666;
        }

        .notice-icon.dark {
            color: #666;
        }

        .notice-icon.dark:hover {
            color: #999;
        }

        /* í—¤ë” */
        .head {
            width: 80%;
            max-width: 1000px;
            min-width: 600px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
        }

        .title-title {
            font-size: 2rem;
            font-weight: 600;
            color: #333;
        }

        .title-title.dark {
            color: #e5e7eb;
        }

        .head-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-btn {
            padding: 0.5rem 1rem;
            border: none;
            background-color: transparent;
            color: #666;
            border-radius: 0.375rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-btn:hover {
            background-color: #f5f5f5;
            color: #333;
        }

        .header-btn.dark {
            color: #999;
        }

        .header-btn.dark:hover {
            background-color: #27272a;
            color: #e5e7eb;
        }

        .dark-mode-icon {
            color: #666;
            cursor: pointer;
            transition: color 0.2s;
        }

        .dark-mode-icon:hover {
            color: #333;
        }

        .dark-mode-icon.dark {
            color: #999;
        }

        .dark-mode-icon.dark:hover {
            color: #e5e7eb;
        }

        /* í”„ë¡œí•„ ë“œë¡­ë‹¤ìš´ */
        .profile-container {
            position: relative;
        }

        .profile-btn {
            padding: 0.5rem 1rem;
            border: none;
            background-color: transparent;
            color: #666;
            border-radius: 0.375rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .profile-btn:hover {
            background-color: #f5f5f5;
            color: #333;
        }

        .profile-btn.dark {
            color: #999;
        }

        .profile-btn.dark:hover {
            background-color: #27272a;
            color: #e5e7eb;
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            min-width: 180px;
            z-index: 1000;
            overflow: hidden;
        }

        .dropdown-menu.dark {
            background-color: #1f1f1f;
            border-color: #3f3f46;
        }

        .dropdown-item {
            padding: 0.75rem 1rem;
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 0.9rem;
        }

        .dropdown-item:hover {
            background-color: #f5f5f5;
            color: #333;
        }

        .dropdown-item.dark {
            color: #999;
        }

        .dropdown-item.dark:hover {
            background-color: #27272a;
            color: #e5e7eb;
        }

        .dropdown-divider {
            height: 1px;
            background-color: #e5e7eb;
            margin: 0.25rem 0;
        }

        .dropdown-divider.dark {
            background-color: #3f3f46;
        }

        /* ì •ë³´ ì˜ì—­ */
        .info-background {
            width: 80%;
            max-width: 1000px;
            min-width: 600px;
            padding: 1rem 0 0;
            margin-bottom: 0.5rem;
        }

        .info-settings {
            display: flex;
            justify-content: flex-end;
            padding: 0 1rem;
            margin-bottom: 1.5rem;
        }

        .result-period-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .result-period-btn {
            border: none;
            background: none;
            color: #666;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .result-period-btn.dark {
            color: #999;
        }

        .result-period-value {
            font-size: 1.3rem;
            color: #333;
            min-width: 2rem;
            text-align: center;
        }

        .result-period-value.dark {
            color: #e5e7eb;
        }

        .info-CPMs {
            display: flex;
            justify-content: space-between;
            padding: 0 1rem;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }

        .CPM-text {
            color: #666;
        }

        .CPM-text.dark {
            color: #999;
        }

        .CPM-value {
            margin-left: 2rem;
            font-weight: 600;
            color: #333;
        }

        .CPM-value.dark {
            color: #ffffff;
        }

        .info-averages {
            display: flex;
            justify-content: space-around;
            padding: 1.5rem 1rem;
            border-top: 1px solid #e5e7eb;
            border-bottom: 1px solid #e5e7eb;
        }

        .info-averages.dark {
            border-top-color: #27272a;
            border-bottom-color: #27272a;
        }

        .info-averages.collapsed {
            display: none;
        }

        .average-label {
            font-size: 1.1rem;
            color: #666;
        }

        .average-label.dark {
            color: #999;
        }

        .average-value {
            margin-left: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .average-value.dark {
            color: #e5e7eb;
        }

        .averages-toggle-container {
            display: flex;
            justify-content: center;
            padding: 0.5rem 0 0 0;
        }

        .averages-toggle-btn {
            border: none;
            background: none;
            color: #999;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            transition: color 0.2s;
        }

        .averages-toggle-btn:hover {
            color: #666;
        }

        .averages-toggle-btn.dark {
            color: #666;
        }

        .averages-toggle-btn.dark:hover {
            color: #999;
        }

        /* íƒ€ì´í•‘ ì˜ì—­ */
        .quote-container {
            width: 80%;
            max-width: 1000px;
            min-width: 600px;
            padding: 0 2rem 2rem;
        }

        .author-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 0.5rem;
        }

        .author-text {
            font-size: 0.95rem;
            color: #999;
        }

        .author-text.dark {
            color: #71717a;
        }

        .sentence-input-wrapper {
            position: relative;
            min-height: 100px;
            line-height: 1.8;
        }

        .character-container {
            position: relative;
            z-index: 1;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .character {
            color: #999;
            line-height: 1.8;
        }

        .character.dark {
            color: #a8a8a8;
        }

        .character-typed {
            color: transparent;
        }

        .input-display {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            line-height: 1.8;
            z-index: 10;
            pointer-events: none;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .input-char-correct {
            color: #333;
        }

        .input-char-correct.dark {
            color: #ffffff;
        }

        .input-char-incorrect {
            color: #dc2626;
        }

        .input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            border: none;
            padding: 0;
            overflow-y: hidden;
            resize: none;
            outline: none;
            background-color: transparent;
            color: transparent;
            caret-color: #6d28d9;
            z-index: 20;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: inherit;
        }

        .input.dark {
            caret-color: #8b5cf6;
        }

        .input::placeholder {
            color: transparent;
        }

        /* Default ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        .quote-container.default-mode .sentence-input-wrapper {
            min-height: auto;
        }

        .quote-container.default-mode .character-container {
            margin-bottom: 1rem;
        }

        .quote-container.default-mode .input-display {
            display: none;
        }

        .quote-container.default-mode .input {
            position: relative;
            border-bottom: 2px solid #6d28d9;
            color: #333;
            padding-bottom: 0.25rem;
        }

        .quote-container.default-mode .input.dark {
            border-bottom-color: #8b5cf6;
            color: #e5e7eb;
        }

        .quote-container.default-mode .input::placeholder {
            color: #999;
        }

        .quote-container.default-mode .input.dark::placeholder {
            color: #71717a;
        }

        .spacer {
            height: 8rem;
        }

        .contact {
            color: #666;
            font-size: 0.9rem;
            text-decoration: none;
            margin-bottom: 2rem;
        }

        .contact.dark {
            color: #999;
        }

        /* ì—…ë°ì´íŠ¸ ê³µì§€ íŒì—… */
        .update-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .update-popup {
            background-color: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 480px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .update-popup.dark {
            background-color: #1f1f1f;
            color: #e5e7eb;
        }

        .update-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .update-popup-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #6d28d9;
        }

        .update-popup-version {
            font-size: 0.85rem;
            color: #999;
        }

        .update-popup-version.dark {
            color: #666;
        }

        .update-popup-date {
            font-size: 0.85rem;
            color: #999;
            margin-bottom: 1.5rem;
        }

        .update-popup-date.dark {
            color: #666;
        }

        .update-popup-close {
            width: 100%;
            padding: 0.75rem;
            margin-top: 1rem;
            border: none;
            border-radius: 0.5rem;
            background-color: #6d28d9;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .update-popup-close:hover {
            background-color: #5b21b6;
        }

        .update-popup-history-btn {
            width: 100%;
            padding: 0.5rem;
            margin-top: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            background-color: transparent;
            color: #666;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .update-popup-history-btn:hover {
            background-color: #f5f5f5;
            color: #333;
        }

        .update-popup-history-btn.dark {
            border-color: #3f3f46;
            color: #999;
        }

        .update-popup-history-btn.dark:hover {
            background-color: #27272a;
            color: #e5e7eb;
        }

        .update-history-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .update-history-item.dark {
            border-bottom-color: #3f3f46;
        }

        .update-history-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .update-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .update-history-version {
            font-weight: 600;
            color: #6d28d9;
        }

        .update-history-date {
            font-size: 0.8rem;
            color: #999;
        }

        .update-history-date.dark {
            color: #666;
        }

        .update-popup-section {
            margin-bottom: 1.25rem;
        }

        .update-popup-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .update-popup-section-title.dark {
            color: #e5e7eb;
        }

        .update-popup-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .update-popup-list li {
            position: relative;
            padding-left: 1.25rem;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
            color: #555;
            line-height: 1.5;
        }

        .update-popup-list li.dark {
            color: #a1a1aa;
        }

        .update-popup-list li::before {
            content: "â€¢";
            position: absolute;
            left: 0;
            color: #6d28d9;
        }

        /* íˆìŠ¤í† ë¦¬ ëª¨ë“œ (ì‘ì€ ì‚¬ì´ì¦ˆ) */
        .update-popup.history-mode .update-popup-section {
            margin-bottom: 0.75rem;
        }

        .update-popup.history-mode .update-popup-section-title {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .update-popup.history-mode .update-popup-list li {
            padding-left: 1rem;
            margin-bottom: 0.25rem;
            font-size: 0.85rem;
        }
    </style>
</head>
<body id="body">
<!-- ì¢Œì¸¡ ìƒë‹¨ ì»¨íŠ¸ë¡¤ -->
<div class="top-left-controls">
    <div class="font-size-slider-container">
        <label class="font-size-label" id="fontSizeLabel" for="fontSizeSlider">Font Size</label>
        <input type="range" class="font-size-slider" id="fontSizeSlider" min="0" max="100" value="50"/>
    </div>
    <div class="mode-toggle-container">
        <span class="mode-toggle-label" id="modeLabel">Compact</span>
        <div class="mode-toggle" id="modeToggle">
            <div class="mode-toggle-knob"></div>
        </div>
    </div>
</div>

<!-- ìš°ì¸¡ ìƒë‹¨ ê³µì§€ ì•„ì´ì½˜ -->
<i class="fa-solid fa-bullhorn notice-icon" id="iconNotice" title="ì—…ë°ì´íŠ¸ ì•ˆë‚´"></i>

<!-- í—¤ë” -->
<div class="head">
    <h1 class="title-title" id="titleTitle">Typing Practice</h1>
    <div class="head-right">
        <button class="header-btn" id="uploadBtn">
            <i class="fa-solid fa-upload"></i>
            <span>ë¬¸ì¥ ì—…ë¡œë“œ</span>
        </button>

        <!-- ë¡œê·¸ì¸ ì „ -->
        <button class="header-btn" id="loginBtn">
            <i class="fa-solid fa-user"></i>
            <span>ë¡œê·¸ì¸</span>
        </button>

        <!-- ë¡œê·¸ì¸ í›„ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) -->
        <div class="profile-container display-none" id="profileContainer">
            <button class="profile-btn" id="profileBtn">
                <i class="fa-solid fa-user-circle"></i>
                <span id="username">í™ë‚¨ê¹€</span>
                <i class="fa-solid fa-chevron-down" style="font-size: 0.7rem;"></i>
            </button>
            <div class="dropdown-menu display-none" id="dropdownMenu">
                <button class="dropdown-item" id="mysentencesBtn">
                    <i class="fa-solid fa-file-lines"></i>
                    <span>ë‚´ ë¬¸ì¥</span>
                </button>
                <button class="dropdown-item" id="statsBtn">
                    <i class="fa-solid fa-chart-line"></i>
                    <span>í†µê³„</span>
                </button>
                <button class="dropdown-item" id="settingsBtn">
                    <i class="fa-solid fa-gear"></i>
                    <span>ì„¤ì •</span>
                </button>
                <div class="dropdown-divider"></div>
                <button class="dropdown-item" id="logoutBtn">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                    <span>ë¡œê·¸ì•„ì›ƒ</span>
                </button>
            </div>
        </div>

        <i class="fa-regular fa-sun fa-xl dark-mode-icon" id="iconSun"></i>
        <i class="fa-regular fa-moon fa-xl dark-mode-icon display-none" id="iconMoon"></i>
    </div>
</div>

<!-- ì •ë³´ ì˜ì—­ -->
<div class="info-background">
    <div class="info-settings">
        <div class="result-period-container">
            <button class="result-period-btn" id="resultPeriodDown">
                <i class="fa-solid fa-chevron-down"></i>
            </button>
            <span class="result-period-value" id="resultPeriodValue">5</span>
            <button class="result-period-btn" id="resultPeriodUp">
                <i class="fa-solid fa-chevron-up"></i>
            </button>
        </div>
    </div>

    <div class="info-CPMs">
        <div>
            <span class="CPM-text">Current CPM</span>
            <span class="CPM-value">8</span>
        </div>
        <div>
            <span class="CPM-text">Highest CPM</span>
            <span class="CPM-value">706</span>
        </div>
    </div>

    <div class="info-averages" id="infoAverages">
        <div>
            <span class="average-label">CPM</span>
            <span class="average-value">706</span>
        </div>
        <div>
            <span class="average-label">ACC</span>
            <span class="average-value">100</span>
        </div>
        <div>
            <span class="average-label">CNT</span>
            <span class="average-value">1</span>
        </div>
    </div>
    <div class="averages-toggle-container">
        <button class="averages-toggle-btn" id="averagesToggleBtn">
            <i class="fa-solid fa-chevron-up" id="averagesToggleIcon"></i>
        </button>
    </div>
</div>

<!-- íƒ€ì´í•‘ ì˜ì—­ -->
<div class="quote-container default-mode" id="quoteContainer">
    <div class="author-container">
        <span class="author-text">ì›°ëŸ¬ë¹„</span>
    </div>
    <div class="sentence-input-wrapper">
        <div class="character-container" id="characterContainer">
            <span class="character">ê°€</span><span class="character">ì‹œ</span><span class="character">ì—</span><span
                class="character"> </span><span class="character">ì ˆ</span><span
                class="character">ë¦¬</span><span class="character">ì§€</span><span
                class="character"> </span><span class="character">ì•Š</span><span
                class="character">ê³ </span><span class="character">ì„œ</span><span
                class="character">ëŠ”</span><span class="character"> </span><span
                class="character">ì¥</span><span class="character">ë¯¸</span><span
                class="character">ë¥¼</span><span class="character"> </span><span
                class="character">ëª¨</span><span class="character">ì„</span><span
                class="character"> </span><span class="character">ìˆ˜</span><span
                class="character"> </span><span class="character">ì—†</span><span
                class="character">ë‹¤</span><span class="character">.</span>
        </div>
        <div class="input-display" id="inputDisplay"></div>
        <label for="quoteInput" class="display-none">íƒ€ì´í•‘ ì…ë ¥</label>
        <textarea class="input" id="quoteInput" rows="1" autofocus autocomplete="off" spellcheck="false"
                  placeholder="ìœ„ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
    </div>
</div>

<div class="spacer"></div>
<a class="contact" href="#">Contact</a>

<!-- ì—…ë°ì´íŠ¸ ê³µì§€ íŒì—… -->
<div class="update-popup-overlay display-none" id="updatePopupOverlay">
    <div class="update-popup" id="updatePopup">
        <div class="update-popup-header">
            <span class="update-popup-title" id="updatePopupTitle">ğŸ‰ ì—…ë°ì´íŠ¸ ì•ˆë‚´</span>
        </div>
        <div id="updateContent"></div>
        <button class="update-popup-close" id="updatePopupClose">í™•ì¸</button>
        <button class="update-popup-history-btn display-none" id="updateHistoryBtn">ì§€ë‚œ ì—…ë°ì´íŠ¸ ë³´ê¸°</button>
    </div>
</div>

<script>
    // í°íŠ¸ í¬ê¸°
    let fontSize = 1.5;

    function sliderToFontSize(v) {
        return 0.8 + (v / 100) * 2.7;
    }

    function fontSizeToSlider(f) {
        return ((f - 0.8) / 2.7) * 100;
    }

    function updateFontSize(size) {
        fontSize = size;
        ['characterContainer', 'inputDisplay', 'quoteInput'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.style.fontSize = size + 'rem';
                if (id === 'quoteInput') {
                    el.style.height = 'auto';
                    el.style.height = el.scrollHeight + 'px';
                }
            }
        });
        localStorage.setItem('Typing-Practice-fontSize', size);
    }

    const slider = document.getElementById('fontSizeSlider');
    const savedFontSize = localStorage.getItem('Typing-Practice-fontSize');
    if (savedFontSize) {
        fontSize = parseFloat(savedFontSize);
        updateFontSize(fontSize);
        slider.value = fontSizeToSlider(fontSize);
    } else {
        updateFontSize(1.5);
    }
    slider.addEventListener('input', e => updateFontSize(sliderToFontSize(parseFloat(e.target.value))));

    // Font Size ë¼ë²¨ í´ë¦­ ì‹œ ë¦¬ì…‹
    document.getElementById('fontSizeLabel').addEventListener('click', () => {
        updateFontSize(1.5);
        slider.value = fontSizeToSlider(1.5);
    });

    // ë‹¤í¬ëª¨ë“œ
    function toggleTheme() {
        document.getElementById('body').classList.toggle('dark');
        document.getElementById('iconSun').classList.toggle('display-none');
        document.getElementById('iconMoon').classList.toggle('display-none');
        document.querySelectorAll('.font-size-label, .font-size-slider, .mode-toggle-label, .mode-toggle, .notice-icon, .title-title, .header-btn, .profile-btn, .dropdown-menu, .dropdown-item, .dropdown-divider, .dark-mode-icon, .result-period-btn, .result-period-value, .CPM-text, .CPM-value, .info-averages, .average-label, .average-value, .averages-toggle-btn, .author-text, .character, .input-char-correct, .input, .contact').forEach(el => el.classList.toggle('dark'));
        localStorage.setItem('Typing-Practice-darkMode', document.getElementById('body').classList.contains('dark'));
    }

    document.getElementById('iconSun').addEventListener('click', toggleTheme);
    document.getElementById('iconMoon').addEventListener('click', toggleTheme);
    if (localStorage.getItem('Typing-Practice-darkMode') === 'true') toggleTheme();

    // textarea ë†’ì´ ìë™ ì¡°ì ˆ
    const textarea = document.getElementById('quoteInput');
    textarea.addEventListener('input', function () {
        this.style.height = 'auto';
        this.style.height = this.scrollHeight + 'px';
    });

    // ë¡œê·¸ì¸ ê´€ë ¨
    let isLoggedIn = false;

    document.getElementById('loginBtn').addEventListener('click', () => {
        isLoggedIn = true;
        document.getElementById('loginBtn').classList.add('display-none');
        document.getElementById('profileContainer').classList.remove('display-none');
    });

    document.getElementById('profileBtn').addEventListener('click', () => {
        document.getElementById('dropdownMenu').classList.toggle('display-none');
    });

    document.addEventListener('click', (e) => {
        const profileContainer = document.getElementById('profileContainer');
        const dropdownMenu = document.getElementById('dropdownMenu');
        if (!profileContainer.contains(e.target) && !dropdownMenu.classList.contains('display-none')) {
            dropdownMenu.classList.add('display-none');
        }
    });

    document.getElementById('uploadBtn').addEventListener('click', () => {
        if (!isLoggedIn) {
            alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.');
            return;
        }
        alert('ë¬¸ì¥ ì—…ë¡œë“œ ê¸°ëŠ¥ (ì¤€ë¹„ ì¤‘)');
    });

    document.getElementById('mysentencesBtn').addEventListener('click', () => {
        alert('ë‚´ ë¬¸ì¥ ê¸°ëŠ¥ (ì¤€ë¹„ ì¤‘)');
        document.getElementById('dropdownMenu').classList.add('display-none');
    });

    document.getElementById('statsBtn').addEventListener('click', () => {
        alert('í†µê³„ ê¸°ëŠ¥ (ì¤€ë¹„ ì¤‘)');
        document.getElementById('dropdownMenu').classList.add('display-none');
    });

    document.getElementById('settingsBtn').addEventListener('click', () => {
        alert('ì„¤ì • ê¸°ëŠ¥ (ì¤€ë¹„ ì¤‘)');
        document.getElementById('dropdownMenu').classList.add('display-none');
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
        isLoggedIn = false;
        document.getElementById('profileContainer').classList.add('display-none');
        document.getElementById('loginBtn').classList.remove('display-none');
        document.getElementById('dropdownMenu').classList.add('display-none');
        alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });

    // í‰ê· ì ìˆ˜ í† ê¸€
    let averagesVisible = localStorage.getItem('Typing-Practice-averagesVisible') !== 'false';
    const infoAverages = document.getElementById('infoAverages');
    const averagesToggleIcon = document.getElementById('averagesToggleIcon');

    function updateAveragesVisibility() {
        if (averagesVisible) {
            infoAverages.classList.remove('collapsed');
            averagesToggleIcon.classList.remove('fa-chevron-down');
            averagesToggleIcon.classList.add('fa-chevron-up');
        } else {
            infoAverages.classList.add('collapsed');
            averagesToggleIcon.classList.remove('fa-chevron-up');
            averagesToggleIcon.classList.add('fa-chevron-down');
        }
    }

    updateAveragesVisibility();

    document.getElementById('averagesToggleBtn').addEventListener('click', () => {
        averagesVisible = !averagesVisible;
        localStorage.setItem('Typing-Practice-averagesVisible', averagesVisible);
        updateAveragesVisibility();
    });

    // ëª¨ë“œ í† ê¸€ (Default / Compact)
    let isCompactMode = localStorage.getItem('Typing-Practice-compactMode') === 'true';
    const modeToggle = document.getElementById('modeToggle');
    const modeLabel = document.getElementById('modeLabel');
    const quoteContainer = document.getElementById('quoteContainer');
    const quoteInput = document.getElementById('quoteInput');

    function updateMode() {
        if (isCompactMode) {
            modeToggle.classList.add('active');
            quoteContainer.classList.remove('default-mode');
            quoteInput.placeholder = '';
        } else {
            modeToggle.classList.remove('active');
            quoteContainer.classList.add('default-mode');
            quoteInput.placeholder = 'ìœ„ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”.';
        }
    }

    updateMode();

    function toggleMode() {
        isCompactMode = !isCompactMode;
        localStorage.setItem('Typing-Practice-compactMode', isCompactMode);
        updateMode();
    }

    modeToggle.addEventListener('click', toggleMode);
    modeLabel.addEventListener('click', toggleMode);

    // ì—…ë°ì´íŠ¸ ê³µì§€ ë°ì´í„°
    const updateHistory = [
        {
            version: "1.2.0",
            date: "2024ë…„ 11ì›” 27ì¼",
            features: [
                "í‰ê· ì ìˆ˜ ì˜ì—­ ì ‘ê¸°/í¼ì¹˜ê¸° ê¸°ëŠ¥ ì¶”ê°€",
                "Default/Compact ëª¨ë“œ ì „í™˜ ê¸°ëŠ¥ ì¶”ê°€"
            ],
            improvements: [
                "ë¬¸ì¥ ì…”í”Œ ì•Œê³ ë¦¬ì¦˜ ê°œì„  (ë” ê· ë“±í•œ ëœë¤ ë¶„ë°°)",
                "ì˜ˆë¬¸ 101ê°œ ì¶”ê°€ (ì´ 1138ê°œ)"
            ]
        },
        {
            version: "1.1.0",
            date: "2024ë…„ 11ì›” 20ì¼",
            features: [
                "í°íŠ¸ í¬ê¸° ì¡°ì ˆ ìŠ¬ë¼ì´ë” ì¶”ê°€",
                "Vercel Analytics ì ìš©"
            ],
            improvements: [
                "í•œê¸€ IME ì…ë ¥ ì•ˆì •í™”",
                "textarea ë†’ì´ ìë™ ì¡°ì ˆ"
            ]
        },
        {
            version: "1.0.0",
            date: "2024ë…„ 11ì›” 15ì¼",
            features: [
                "íƒ€ì ì—°ìŠµ ì„œë¹„ìŠ¤ ì˜¤í”ˆ",
                "ì‹¤ì‹œê°„ íƒ€ì ì†ë„(CPM) ì¸¡ì •",
                "ì •í™•ë„ ë¶„ì„",
                "ë‹¤í¬ ëª¨ë“œ ì§€ì›"
            ],
            improvements: []
        }
    ];

    const CURRENT_VERSION = updateHistory[0].version;
    const updatePopupOverlay = document.getElementById('updatePopupOverlay');
    const updatePopup = document.getElementById('updatePopup');
    const updatePopupTitle = document.getElementById('updatePopupTitle');
    const updateContent = document.getElementById('updateContent');
    const updateHistoryBtn = document.getElementById('updateHistoryBtn');

    // ìµœì‹  ì—…ë°ì´íŠ¸ ë Œë”ë§ (ì²« ì§„ì… ì‹œ)
    function renderLatestUpdate(update) {
        const isDark = document.getElementById('body').classList.contains('dark');
        const darkClass = isDark ? ' dark' : '';

        let html = `
            <div class="update-popup-version${darkClass}">v${update.version}</div>
            <div class="update-popup-date${darkClass}">${update.date}</div>
        `;

        if (update.features && update.features.length > 0) {
            html += `
                <div class="update-popup-section">
                    <div class="update-popup-section-title${darkClass}">âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥</div>
                    <ul class="update-popup-list">
                        ${update.features.map(f => `<li class="${darkClass}">${f}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        if (update.improvements && update.improvements.length > 0) {
            html += `
                <div class="update-popup-section">
                    <div class="update-popup-section-title${darkClass}">ğŸ”§ ê°œì„ ì‚¬í•­</div>
                    <ul class="update-popup-list">
                        ${update.improvements.map(i => `<li class="${darkClass}">${i}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        return html;
    }

    // íˆìŠ¤í† ë¦¬ ì•„ì´í…œ ë Œë”ë§ (ì•„ì´ì½˜ í´ë¦­ ì‹œ)
    function renderHistoryItem(update) {
        const isDark = document.getElementById('body').classList.contains('dark');
        const darkClass = isDark ? ' dark' : '';

        let html = `
            <div class="update-history-item${darkClass}">
                <div class="update-history-header">
                    <span class="update-history-version">v${update.version}</span>
                    <span class="update-history-date${darkClass}">${update.date}</span>
                </div>
        `;

        if (update.features && update.features.length > 0) {
            html += `
                <div class="update-popup-section">
                    <div class="update-popup-section-title${darkClass}">âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥</div>
                    <ul class="update-popup-list">
                        ${update.features.map(f => `<li class="${darkClass}">${f}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        if (update.improvements && update.improvements.length > 0) {
            html += `
                <div class="update-popup-section">
                    <div class="update-popup-section-title${darkClass}">ğŸ”§ ê°œì„ ì‚¬í•­</div>
                    <ul class="update-popup-list">
                        ${update.improvements.map(i => `<li class="${darkClass}">${i}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        html += '</div>';
        return html;
    }

    // ëª¨ë“  ì—…ë°ì´íŠ¸ ë Œë”ë§
    function renderAllUpdates() {
        let html = '';
        for (const update of updateHistory) {
            html += renderHistoryItem(update);
        }
        return html;
    }

    // ì²« ì§„ì… ì‹œ ìµœì‹  ì—…ë°ì´íŠ¸ë§Œ í‘œì‹œ
    function openLatestUpdatePopup() {
        updatePopupOverlay.classList.remove('display-none');
        updatePopup.classList.remove('history-mode');
        updatePopupTitle.textContent = 'ğŸ‰ ì—…ë°ì´íŠ¸ ì•ˆë‚´';
        updateContent.innerHTML = renderLatestUpdate(updateHistory[0]);
        updateHistoryBtn.classList.remove('display-none');

        if (document.getElementById('body').classList.contains('dark')) {
            updatePopup.classList.add('dark');
            updateHistoryBtn.classList.add('dark');
        }
    }

    // ì•„ì´ì½˜ í´ë¦­ ì‹œ ëª¨ë“  ì—…ë°ì´íŠ¸ í‘œì‹œ
    function openAllUpdatesPopup() {
        updatePopupOverlay.classList.remove('display-none');
        updatePopup.classList.add('history-mode');
        updatePopupTitle.textContent = 'ğŸ“‹ ì—…ë°ì´íŠ¸ ë‚´ì—­';
        updateContent.innerHTML = renderAllUpdates();
        updateHistoryBtn.classList.add('display-none');

        if (document.getElementById('body').classList.contains('dark')) {
            updatePopup.classList.add('dark');
        }
    }

    function closeUpdatePopup() {
        updatePopupOverlay.classList.add('display-none');
        localStorage.setItem('Typing-Practice-lastSeenVersion', CURRENT_VERSION);
    }

    // ìƒˆ ë²„ì „ì´ë©´ ìë™ìœ¼ë¡œ íŒì—… í‘œì‹œ
    function showUpdatePopupIfNew() {
        const lastSeenVersion = localStorage.getItem('Typing-Practice-lastSeenVersion');
        if (lastSeenVersion !== CURRENT_VERSION) {
            openLatestUpdatePopup();
        }
    }

    document.getElementById('updatePopupClose').addEventListener('click', closeUpdatePopup);
    document.getElementById('iconNotice').addEventListener('click', openAllUpdatesPopup);
    updateHistoryBtn.addEventListener('click', openAllUpdatesPopup);

    // í˜ì´ì§€ ë¡œë“œ ì‹œ íŒì—… í‘œì‹œ
    showUpdatePopupIfNew();
</script>
</body>
</html>
